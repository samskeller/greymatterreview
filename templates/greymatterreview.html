<!DOCTYPE HTML>
<html>
	<head>
		<title>The Grey Matter Review</title>
		<link rel="stylesheet" type="text/css" href="/stylesheets/greystyles.css"/>
		<script type="text/javascript" src="/scripts/jquery-1.9.1.min.js"></script>
		
		<script>
		$(document).ready(function(){
			$('html').click(function() {
				// Hide menus on any click so the user can click away from them to hide them
				var loginTrigger = $("#login-trigger");
				loginTrigger.next('#login-content').toggle(false);
				loginTrigger.removeClass('active');
				
				var signupTrigger = $("#signup-trigger");
				signupTrigger.next('#signup-content').toggle(false);
				signupTrigger.removeClass('active');
				
				var meTrigger = $("#me-trigger");
				//meTrigger.next('#me-content').toggle(false);
				meTrigger.next('#me-content').slideUp(100);
				meTrigger.removeClass('active');
			});
			
			// If we clicked on the login box, though, don't do the code from above
			$("#login-content").click(function(){
				event.stopPropagation();
			});
			
			// Or if we clicked on the signup box, though, don't do the code from above
			$("#signup-content").click(function(){
				event.stopPropagation();
			});
			
			// Handling the login trigger to show the dropdown
			$('#login-trigger').click(function(){
				event.stopPropagation();
				var signupTrigger = $("#signup-trigger");
				if (signupTrigger.hasClass('active') || !$(this).hasClass('active')) {
					signupTrigger.next('#signup-content').toggle(false);
					signupTrigger.removeClass('active');
					$(this).next('#login-content').toggle(true);
					$(this).addClass('active');
				} else {
					$(this).next('#login-content').toggle(false);
					$(this).toggleClass('active');
				}
			});
			
			// Handling the signup trigger to show the dropdown
			$('#signup-trigger').click(function(){
				event.stopPropagation();
				var loginTrigger = $("#login-trigger");
				if (loginTrigger.hasClass('active') || !$(this).hasClass('active')) {
					loginTrigger.next('#login-content').toggle(false);
					loginTrigger.removeClass('active');
					$(this).next('#signup-content').toggle(true);
					$(this).addClass('active');
				} else {
					$(this).next('#signup-content').toggle(false);
					$(this).toggleClass('active');
				}
			});
			
			// If we clicked on the profile box, though, don't do the code from above
			$("#me-content").click(function(){
				event.stopPropagation();
			});
	
			// Handling the profile trigger to show the dropdown
			$('#me-trigger').click(function(){
				event.stopPropagation();
				var signupTrigger = $("#signup-trigger");
				if ($(this).hasClass('active')) {
					//$(this).next('#me-content').toggle(false);
					$(this).next('#me-content').slideUp(100);
					$(this).toggleClass('active');
				} else {
					//$(this).next('#me-content').toggle(true);
					$(this).next('#me-content').slideDown(100);
					$(this).addClass('active');
				}
			});
			
		  });
		</script>
        <script>
        function changeSearchParam(newValue) {
        	document.getElementById("searchbtn").value = "Find " + newValue;
        	
        }
        </script>
	</head>
<body id="newbody">
	<div id="top">
		<div id="logoHolder">
			<a href="/"><span id="emptySpan"></span></a><img id="toplogo" src="/stylesheets/GMLOGO_grey.jpg" alt="Unknown Person" width=40 height=40>
		</div>
		<nav id="loginNav">
			<ul>
				{% if user: %}
				<li id="me-container">
					<a id="me-trigger" href="#">
						{{user.username}}
					</a>
					<div id="me-content">
						<img id="toplogo" src="/stylesheets/GMLOGO_grey.jpg" alt="Unknown Person" width=60 height=60>
						<a href="/home">My Page</a>
						<br>
						<a href="/logout" style="padding-top:10px;">Logout</a>
					</div>
				</li>
		        {% else %}
				<li id="login-container">
					<a id="login-trigger" href="#">
						Log in
					</a>
					<div id="login-content">
						<form method="post" action="/">
							<fieldset id="inputs">
								<input id="login_username" name="username" placeholder="Username" required>   
								<input id="login_password" type="password" name="password" placeholder="Password" required>
							</fieldset>
							<fieldset id="actions">
								<input type="submit" id="login_submit" name="loginbutton" value="Log in">
							</fieldset>
						</form>
					</div>                     
				</li>
				<li id="signup-container">
					<a id="signup-trigger" href="#">
						Sign up
					</a>
					<div id="signup-content">
						<form method="post" action="/">
							<fieldset id="inputs">
								<input id="signup_username" name="signupUsername" placeholder="Username" required>
								<input id="signup_email" name="signupEmail" placeholder="Email" required>
								<input id="signup_password" type="password" name="signupPassword" placeholder="Password" required>
							</fieldset>
							<fieldset id="actions">
								<input type="submit" id="signup_submit" name="signupbutton" value="Join">
							</fieldset>
						</form>
					</div>
				</li>
        		{% endif %}
			</ul>
		</nav>
	</div>
	<br>
	<div id="loginerror">{{login_error}}</div>
	{% if user: %}
		<div id="welcome_message">Welcome, {{user.username}}!</div>
	{% endif %}
	<div id="description">
		<a href="/" style="text-decoration:none;"><label id="website_title"><span id="emptySpan"></span>grey<br>matter</label></a>
	</div>
	<div id="mission">what do you have to say about music?</div>
	<div id="searchBar">
		<form method="post" action="/reviews">
		<input type="text" id="searchinput" placeholder="Enter artist or album name" name="searchinput">
		<select id="searchdropdown" name="searchdropdown" onChange="changeSearchParam(this.value);">
			<option value="artists">Artists</option>
			<option value="albums">Albums</option>
		</select>	
		<input type="submit" value="Find Artists" id="searchbtn" name="searchbtn">
		</form>
	</div>
	<div id="recentReviews">
		Latest Reviews:
		<br><br>
		{% for i in range(reviews|length): %}
			{% if i == 0: %}
				<div class="profileReviewLarge">
					<a href="/reviews/{{reviews[i]['keyID']}}" style="text-decoration:none;">
					<img src="http://www.coverartarchive.com/release/{{reviews[i]['mb_id']}}/front" width="175" height="175" align="middle" style="float:left;margin-right:10px;margin-top:11px;margin-left:10px;">
					<span id="reviewRating">{{reviews[i]['rating']}} / 10</span>
					<br>
					Artist: {{reviews[i]['artist']}}<span style="float:right;">{{reviews[i]['timePassed']}}</span>
					<br>
					Album: {{reviews[i]['album']}}
					<br>
					"{{reviews[i]['reviewer']}}" said: {{reviews[i]['reviewText']}}
					<span id="emptySpan"></span>
					</a>
				</div>
				<br>
			{% else: %}
				<div class="profileReview">
					<a href="/albums/{{reviews[i]['mb_id']}}" style="text-decoration:none;">
					<img src="http://www.coverartarchive.com/release/{{reviews[i]['mb_id']}}/front" width="100" height="100" align="middle" style="margin-right:20px;display:block;margin-left:15px;">
					<span id="reviewRating">{{reviews[i]['rating']}} / 10</span>
					<br>
					<span style="font-size:20px;">{{reviews[i]['artist']}}</span>
					<br>
					<span style="font-size:20px;font-style:italic;">{{reviews[i]['album']}}</span>
					<br>
					"{{reviews[i]['reviewer']}}" said: {{reviews[i]['reviewText']}}
					<span id="emptySpan"></span>
					</a>
				</div>
			{% endif %}
		{% endfor %}
	</div>
	</div>
	</form>
		
</body>
</html>
